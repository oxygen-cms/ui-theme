"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getFormData(e){var t={},n=!0,r=!1,i=void 0;try{for(var a,o=e.querySelectorAll("[name]")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if("checkbox"!=s.type&&"radio"!=s.type||s.checked)if(void 0==s.name&&console.dir(s),"select-multiple"==s.type){t[s.name]=[];var l=!0,c=!1,u=void 0;try{for(var d,h=s.options[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var f=d.value;f.selected&&t[s.name].push(f.value)}}catch(v){c=!0,u=v}finally{try{!l&&h["return"]&&h["return"]()}finally{if(c)throw u}}}else if("file"==s.type){var m,y=null!=(m=s.filesToUpload)?m:s.files;t[s.name]=[];for(var g,p=0;p<y.length;p++)g=y[p],t[s.name].push(g)}else t[s.name]=s.value}}catch(v){r=!0,i=v}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}return t}function getFormDataObject(e){var t=new FormData;for(var n in e)if(e[n]instanceof Array){var r=!0,i=!1,a=void 0;try{for(var o,s=e[n][Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;t.append(n,l)}}catch(c){i=!0,a=c}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw a}}}else t.append(n,e[n]);return t}function formDataEqual(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;for(var r in e)if(e.hasOwnProperty(r)&&e[r]!==t[r])return!1;return!0}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fileSize(e){var t,n,r,i;for(i=e+" bytes",r=["KB","MB","GB","TB","PB","EB","ZB","YB"],n=0,t=e/1024;t>1;)i=t.toFixed(3)+" "+r[n],t/=1024,n++;return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function serializeToQueryString(e){return Object.keys(e).reduce(function(t,n){return t.push(n+"="+encodeURIComponent(e[n])),t},[]).join("&")}var parentMatchingSelector=function(e,t){for(;e&&e!==document;e=e.parentNode)if(e.matchesSelector(t))return e;return null},parentOrSelfMatchingSelector=function(e,t){if(e.matchesSelector(t))return e;for(;e&&e!==document;e=e.parentNode)if(e.matchesSelector(t))return e;return null};NodeList.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator],HTMLCollection.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator];var matchesMethod=function(){var e=Element.prototype;if(e.matches)return"matches";if(e.matchesSelector)return"matchesSelector";for(var t=["webkit","moz","ms","o"],n=0;n<t.length;n++){var r=t[n],i=r+"MatchesSelector";if(e[i])return i}}();Element.prototype.matchesSelector=function(e){return this[matchesMethod](e)};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Dialog=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerEvents",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.querySelectorAll('[data-dialog-type="confirm"]')[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.addEventListener("click",e.handleConfirmClick)}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}var c=!0,u=!1,d=void 0;try{for(var h,f=t.querySelectorAll('[data-dialog-type="alert"]')[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var v=h.value;v.addEventListener("click",e.handleAlertClick)}}catch(l){u=!0,d=l}finally{try{!c&&f["return"]&&f["return"]()}finally{if(u)throw d}}}},{key:"handleAlertClick",value:function(e){vex.dialog.alert(e.currentTarget.getAttribute("data-dialog-message"))}},{key:"handleConfirmClick",value:function(e,t){var n=e.currentTarget;if("true"!==n.getAttribute("data-dialog-disabled")){var r;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),r={message:n.getAttribute("data-dialog-message"),callback:function(e){e&&(n.setAttribute("data-dialog-disabled","true"),n.click())}};for(var i in t)r[i]=t[i];return vex.dialog.confirm(r)}}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Dropdown=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerGlobalEvent",value:function(){return document.addEventListener("click",e.handleGlobalClick)}},{key:"registerEvents",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.querySelectorAll("."+e.classes.dropdownToggle)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.addEventListener("click",e.handleClick)}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}},{key:"handleClick",value:function(t){for(var n=t.target;!n.classList.contains(e.classes.dropdownToggle);){if(n.matchesSelector("a[href], form"))return;n=n.parentNode}var r=n.querySelector("."+e.classes.dropdownList);r.classList.contains(e.classes.isActive)?r.classList.remove(e.classes.isActive):(e.reset(),r.classList.add(e.classes.isActive))}},{key:"handleGlobalClick",value:function(t){null==parentMatchingSelector(t.target,"."+e.classes.dropdownToggle)&&e.reset()}},{key:"reset",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=document.querySelectorAll("."+e.classes.dropdownList)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.classList.remove(e.classes.isActive)}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}}]),e}();Dropdown.classes={dropdownToggle:"Dropdown-container",dropdownList:"Dropdown",isActive:"is-active"};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),EditableList=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerEvents",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.getElementsByClassName(e.classes.add)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.addEventListener("click",e.handleAdd)}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}t.addEventListener("click",e.handleRemove)}},{key:"handleAdd",value:function(t){var n=t.currentTarget.parentNode.querySelector("."+e.classes.container),r=n.querySelector("."+e.classes.template),i=r.cloneNode(!0);i.classList.remove(e.classes.template),n.appendChild(i)}},{key:"handleRemove",value:function(t){var n=parentOrSelfMatchingSelector(t.target,"."+e.classes.row);if(n){var r=parentMatchingSelector(t.target,"."+e.classes.row);r&&(r.parentNode.removeChild(r),console.log("removed node"))}}}]),e}();EditableList.classes={container:"EditableList",template:"EditableList-template",row:"EditableList-row",remove:"EditableList-remove",add:"EditableList-add"};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();window.Oxygen||(window.Oxygen={});var FetchOptions=function(){function e(){_classCallCheck(this,e),this.headers=new Headers}return _createClass(e,[{key:"wantJson",value:function(){return this.headers.set("Accept","application/json"),this}},{key:"contentType",value:function(e){return this.headers.set("Content-Type",e),this}},{key:"method",value:function(e){return this.method=e,this}},{key:"body",value:function(e){return this.body=e,this}},{key:"cookies",value:function(){return this.credentials="same-origin",this}}],[{key:"default",value:function(){return(new e).cookies()}}]),e}();Oxygen.respond={},Oxygen.respond.text=function(e){return e.text()},Oxygen.respond.json=function(e){return e.json()},Oxygen.respond.checkStatus=function(e){if(e.ok)return e;var t=new Error;throw t.response=e,t},Oxygen.respond.notification=function(e){return Notification.isNotification(e)&&NotificationCenter.present(new Notification(e)),e},Oxygen.respond.redirect=function(e){return e.redirect&&(window.smoothState&&e.hardRedirect!==!0?window.smoothState.load(e.redirect,!1):window.location.replace(e.redirect)),e},Oxygen.respond.handleAPIError=function(e){if(!(e.response&&e.response instanceof Response))throw e;e.response.json().then(Oxygen.handleAPIError)},Oxygen.handleAPIError=function(e){console.error(e),Notification.isNotification(e)?NotificationCenter.present(new Notification(e)):e.error?NotificationCenter.present(new Notification({content:'PHP Exception of type <code class="no-wrap">'+e.error.type+'</code> with message <code class="no-wrap">'+e.error.message+'</code> thrown at <code class="no-wrap">'+e.error.file+":"+e.error.line+"</code>",status:"bug"})):(console.log("JSON error response unhandled: ",e),NotificationCenter.present(new Notification({content:"Whoops, looks like something went wrong.",status:"failed"})))};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Form=function(){function e(t){_classCallCheck(this,e),this.form=t,this.originalData=getFormData(this.form),this.contentGenerators=[],this.registerEvents()}return _createClass(e,null,[{key:"findAll",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.querySelectorAll("form")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.formObject=new e(s)}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}$(t).find(e.classes.taggableInput).tagging({"edit-on-delete":!1})}},{key:"registerKeydownHandler",value:function(){return document.addEventListener("keydown",e.handleKeydown)}},{key:"handleKeydown",value:function(t){if((t.ctrlKey||t.metaKey)&&83===t.which)for(var n=document.getElementsByTagName("form"),r=0;r<n.length;r++){var i=n[r];i.classList.contains(e.classes.submitOnKeydown)&&i.formObject&&(i.formObject.submit(),t.preventDefault())}}}]),_createClass(e,[{key:"registerEvents",value:function(){var t=this;if(this.form.classList.contains(e.classes.warnBeforeExit)){var n=!0,r=!1,i=void 0;try{for(var a,o=document.querySelectorAll('a, button[type="submit"]')[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.addEventListener("click",function(e){return t.handleExit(e)})}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}return this.form.addEventListener("submit",function(e){return t.handleSubmit(e)}),this.form.classList.contains(e.classes.submitAsyncOnChange)&&this.form.addEventListener("change",function(e){e.preventDefault(),t.submitAsync()}),this.form.classList.contains(e.classes.autoSubmit)?this.submit():void 0}},{key:"handleExit",value:function(t){var n=this;if(!t.currentTarget.classList.contains("Form-submit")&&(this.generateContent(),console.log(getFormData(this.form)),console.log(this.originalData),!formDataEqual(getFormData(this.form),this.originalData))){var r=t.currentTarget;"true"!==r.getAttribute("data-dialog-disabled")&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),vex.dialog.confirm({message:e.messages.confirmation,buttons:[{text:"Save",type:"button",className:"vex-dialog-button-primary",click:function(e,t){e.data().vex.value="save",vex.close(e.data().vex.id)}},$.extend({},vex.dialog.buttons.NO,{text:"Cancel"}),{text:"Don't Save",type:"button",className:"vex-dialog-button-secondary vex-dialog-button-left",click:function(e,t){e.data().vex.value="continue",vex.close(e.data().vex.id)}}],callback:function(t){return"continue"==t?(r.setAttribute("data-dialog-disabled","true"),r.click()):void("save"==t&&(n.form.classList.contains(e.classes.submitAsync)?(n.submitAsync(!0),r.setAttribute("data-dialog-disabled","true"),r.click()):n.submit()))}}))}}},{key:"submit",value:function(){this.form.querySelector('button[type="submit"]').click()}},{key:"generateContent",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.contentGenerators[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;a(this)}}catch(o){t=!0,n=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}}},{key:"handleSubmit",value:function(t){this.generateContent(),this.form.classList.contains(e.classes.submitAsync)&&!e.disableAsync&&(t.preventDefault(),this.submitAsync())}},{key:"submitAsync",value:function(e){var t=this,n=function(e){return"success"===e.status&&(t.originalData=getFormData(t.form),console.log("Form Saved Successfully")),e},r=getFormData(this.form);console.log("Submitting Form with Data: ",r);var i=window.fetch(this.form.action,FetchOptions["default"]().method(this.form.method).body(getFormDataObject(r)).wantJson()).then(Oxygen.respond.checkStatus).then(Oxygen.respond.json).then(n),a=this.form.modifyPromise;return void 0===a&&(a=function(e){return e}),i=i.then(Oxygen.respond.notification),e||(i=i.then(Oxygen.respond.redirect)),i=a(i),i=i["catch"](Oxygen.respond.handleAPIError)}}]),e}();Form.disableAsync=!1,document.addEventListener("keydown",function(e){e.altKey&&(e.controlKey||e.metaKey)&&74==e.which&&(Form.disableAsync=!Form.disableAsync,e.preventDefault(),NotificationCenter.present(new Notification({content:"Asynchronous form submission "+(Form.disableAsync?"disabled":"enabled"),status:"info"})))}),Form.messages={confirmation:"Do you want to save changes?"},Form.classes={warnBeforeExit:"Form--warnBeforeExit",submitOnKeydown:"Form--submitOnKeydown",submitAsync:"Form--sendAjax",submitAsyncOnChange:"Form--sendAjaxOnChange",autoSubmit:"Form--autoSubmit",taggableInput:".Form-taggable"};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),MainNav=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"headroom",value:function t(){var e=document.querySelector(".MainNav");if(e&&window.innerWidth>768){var t=new Headroom(e,{tolerance:20,offset:50,classes:{initial:"Headroom",pinned:"Headroom--pinned",unpinned:"Headroom--unpinned",top:"Headroom--top",notTop:"Headroom--not-top"}});t.init()}}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),NotificationCenter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"initializeExistingMessages",value:function(){var t=document.querySelector("."+Notification.classes.container).querySelectorAll("."+Notification.classes.item),n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;e.registerHide(new Notification({message:s}))}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}},{key:"present",value:function(t){document.querySelector("."+Notification.classes.container).appendChild(t.message),e.registerHide(t)}},{key:"registerHide",value:function(t){var n=setTimeout(function(){e.hide(t)},5e3);t.message.addEventListener("click",function(r){e.hide(t),clearTimeout(n)})}},{key:"hide",value:function(e){e.message.classList.add("is-sliding-up"),setTimeout(function(){var t=e.message;t.parentNode&&t.parentNode.removeChild(t)},500)}}]),e}(),Notification=function(){function e(t){if(_classCallCheck(this,e),t.log&&console.log(t.log),t.message)this.message=t.message,this.message.classList.remove("is-hidden");else{if(!t.status||!t.content)throw new Error("Invalid Arguments For New Notification: "+JSON.stringify(t));this.message=document.createElement("div"),this.message.classList.add(e.classes.item),this.message.classList.add("Notification--"+t.status),this.message.innerHTML=t.content+'<span class="Notification-dismiss Icon Icon-times"></span>'}}return _createClass(e,null,[{key:"isNotification",value:function(e){return void 0!==e.message||void 0!==e.content&&void 0!==e.status}}]),e}();Notification.classes={container:"Notification-container",item:"Notification"};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Preferences=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"setPreferences",value:function(t){return e.preferences=t}},{key:"get",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=e.preferences;if("undefined"==typeof r||null===r)return n;for(var i=t.split("."),a=i.pop(),o=i.length,s=1,l=i[0];(r=r[l])&&o>s;)l=i[s],s++;return r?r[a]:n}},{key:"has",value:function(t){var n=e.preferences;if(!n)return!1;for(var r=t.split("."),i=(r.pop(),r.length),a=1,o=r[0];(n=n[o])&&i>a;)o=r[a],a++;return n}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Slider=function(){function e(t){_classCallCheck(this,e),this.container=t,this.list=this.container.querySelector(e.selectors.list),this.items=this.container.querySelectorAll(e.selectors.item),this.total=this.items.length,this.interval=this.container.getAttribute("data-interval")||5e3,this.previousId=0,this.currentId=0,this.nextId=0,this.animating=!1,this.animationTime=1e3,this.registerEvents(),this.hideAll(),this.next(),"true"===this.container.getAttribute("data-autoplay")&&this.play()}return _createClass(e,null,[{key:"findAll",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.querySelectorAll(e.selectors.slider)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;e.list.push(new e(s))}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}}]),_createClass(e,[{key:"registerEvents",value:function(){this.container.querySelector(e.selectors.back).addEventListener("click",this.previous.bind(this)),this.container.querySelector(e.selectors.forward).addEventListener("click",this.next.bind(this))}},{key:"play",value:function(){var e="reverse"===this.container.getAttribute("data-direction")?this.previous.bind(this):this.next.bind(this);this.timer=setInterval(e,this.interval)}},{key:"pause",value:function(){clearInterval(this.timer)}},{key:"getItem",value:function(e){return this.list.querySelector(":nth-child("+e+")")}},{key:"hideAll",value:function(){this.items.className="",this.items.classList.add(e.classes.item),this.items.classList.add(e.classes.isHidden)}},{key:"next",value:function(){if(!this.shouldAnimate())return!1;this.previousId=this.currentId,this.currentId+=1,this.currentId>this.total&&(this.currentId=1),this.nextId=this.currentId+1,this.nextId>this.total&&(this.nextId=1),current=this.getItem(this.currentId),previous=this.getItem(this.previousId),this.hideAll();var t=!0,n=!1,r=void 0;try{for(var i,a=e.allClasses()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)item=i.value,previous.classList.remove(item),current.classList.remove(item)}catch(o){n=!0,r=o}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw r}}previous.classList.add(e.classes.slideOutLeft),current.classList.add(e.classes.slideInRight)}},{key:"previous",value:function(){if(!this.shouldAnimate())return!1;this.nextId=this.currentId,this.currentId-=1,this.currentId<1&&(this.currentId=this.total),this.previousId=this.currentId-1,this.nextId<1&&(this.nextId=this.total),current=this.getItem(this.currentId),next=this.getItem(this.nextId),this.hideAll();var t=!0,n=!1,r=void 0;try{for(var i,a=e.allClasses()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)item=i.value,next.classList.remove(item),current.classList.remove(item)}catch(o){n=!0,r=o}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw r}}next.classList.add(e.classes.slideOutRight),current.classList.add(e.classes.slideInLeft)}},{key:"shouldAnimate",value:function(){var e=this;return this.animating?!1:(this.animating=!0,setTimeout(function(){e.animating=!1},this.animationTime),!0)}}],[{key:"allClasses",value:function(){return e.classes.isHidden+" "+e.classes.slideInLeft+" "+e.classes.slideInRight+" "+e.classes.slideOutLeft+" "+e.classes.slideOutRight}}]),e}();Slider.selectors={slider:".Slider",list:".Slider-list",item:".Slider-item",back:".Slider-back",forward:".Slider-forward"},Slider.classes={item:"Slider-item",isCurrent:"Slider-item--current",isHidden:"Slider-item--hidden",slideInLeft:"Slider-item--slideInLeft",slideInRight:"Slider-item--slideInRight",slideOutLeft:"Slider-item--slideOutLeft",slideOutRight:"Slider-item--slideOutRight",isAfter:"Slider-item--after",noTransition:"Slider--noTransition"},Slider.list=[];var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),SmoothState=function(){function e(){_classCallCheck(this,e),this.loading=!1,this.smoothState=$("#page").smoothState({anchors:".Link--smoothState",root:$(document),cacheLength:0,forms:"null",onStart:{duration:350,render:this.onStart},onProgress:{duration:0,render:this.onProgress},onReady:{duration:0,render:this.onReady},onAfter:this.onAfter}).data("smoothState")}return _createClass(e,[{key:"onStart",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=document.querySelectorAll("html, body")[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;o.scrollTop=0}}catch(s){n=!0,r=s}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw r}}this.loading=!0;var l=document.getElementsByClassName("Block"),c=Array.prototype.slice.call(l);c.reverse();for(var u=function(e){var t=c[e];setTimeout(function(){return t.classList.add("Block--isExiting")},50*e)},d=0;d<c.length;d++)u(d)}},{key:"onProgress",value:function(t){e.setCursor("wait")}},{key:"onReady",value:function(t,n){e.setCursor("auto"),Oxygen.reset(),t[0].style.display="none",t.html(n),document.querySelector(".pace-activity").classList.remove("pace-activity-active");for(var r=document.getElementsByClassName("Block"),i=function(){var e=r[a];e.classList.add("Block--isHidden"),setTimeout(function(){e.classList.remove("Block--isHidden"),e.classList.add("Block--isEntering"),setTimeout(function(){e.classList.remove("Block--isEntering")},250)},50*a)},a=0;a<r.length;a++)i();t[0].style.display="block"}},{key:"onAfter",value:function(e,t){return this.loading=!1,Oxygen.init(document.getElementById("page"))}},{key:"load",value:function(e,t){return this.smoothState.load(e,t)}}],[{key:"setCursor",value:function(e){var t=document.querySelectorAll("html, body"),n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.style.cursor=e}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}var c=document.querySelectorAll("a"),u=!0,d=!1,h=void 0;try{for(var f,v=c[Symbol.iterator]();!(u=(f=v.next()).done);u=!0){var m=f.value;m.style.cursor=e}}catch(l){d=!0,h=l}finally{try{!u&&v["return"]&&v["return"]()}finally{if(d)throw h}}}},{key:"setTheme",value:function(e){console.log("Setting SmoothState Theme: ",e);var t=document.getElementById("page");t&&t.classList.add("Page-transition--"+e)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),TabSwitcher=function(){function e(t,n){_classCallCheck(this,e),this.tabs=t,this.content=n,this.findDefault(),this.registerEvents()}return _createClass(e,null,[{key:"findAll",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.querySelectorAll(e.selectors.container)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;console.log(s);var l=s.matchesSelector(e.selectors.tabs)?s:s.querySelector(e.selectors.tabs),c=s.matchesSelector(e.selectors.content)?s:s.querySelector(e.selectors.content);e.list.push(new e(l,c))}}catch(u){r=!0,i=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}}]),_createClass(e,[{key:"findDefault",value:function(){var e=this.tabs.querySelector("[data-default-tab]").getAttribute("data-switch-to-tab");this.setTo(e)}},{key:"registerEvents",value:function(){var e=this;this.tabs.querySelectorAll("[data-switch-to-tab]").forEach(function(t){t.addEventListener("click",function(t){e.setTo(t.currentTarget.getAttribute("data-switch-to-tab"))})})}},{key:"setTo",value:function(t){this.current=t;var n=!0,r=!1,i=void 0;try{for(var a,o=this.content.querySelectorAll("[data-tab]")[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.classList.remove(e.classes.active)}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}this.content.querySelector('[data-tab="'+t+'"]').classList.add(e.classes.active);var c=!0,u=!1,d=void 0;try{for(var h,f=this.tabs.querySelectorAll("[data-switch-to-tab]")[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var v=h.value;v.classList.remove(e.classes.active)}}catch(l){u=!0,d=l}finally{try{!c&&f["return"]&&f["return"]()}finally{if(u)throw d}}this.tabs.querySelector('[data-switch-to-tab="'+t+'"]').classList.add(e.classes.active)}}]),e}();TabSwitcher.classes={active:"TabSwitcher--isActive"},TabSwitcher.selectors={container:".TabSwitcher",tabs:".TabSwitcher-tabs",content:".TabSwitcher-content"},TabSwitcher.list=[];var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Toggle=function(){function e(t,n,r){_classCallCheck(this,e),this.toggle=t,this.enableCallback=n,this.disableCallback=r,this.registerEvents()}return _createClass(e,[{key:"registerEvents",value:function(){var e=this;this.toggle.addEventListener("click",function(t){return e.handleToggle(t)}),void 0==this.toggle.getAttribute("data-enabled")&&this.toggle.setAttribute("data-enabled","false")}},{key:"handleToggle",value:function(e){"true"===this.toggle.getAttribute("data-enabled")?(this.toggle.setAttribute("data-enabled","false"),this.disableCallback(e)):(this.toggle.setAttribute("data-enabled","true"),this.enableCallback(e))}}]),e}();Toggle.classes={ifEnabled:"Toggle--ifEnabled",ifDisabled:"Toggle--ifDisabled"};var FullscreenToggle=function(e){function t(e,n){var r=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],i=arguments.length<=3||void 0===arguments[3]?function(){}:arguments[3];_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,null,null));return a.fullscreenElement=n,a.enableCallback=a.enterFullscreen,a.disableCallback=a.exitFullscreen,a.enterFullscreenCallback=r,a.exitFullscreenCallback=i,a}return _inherits(t,e),_createClass(t,[{key:"enterFullscreen",value:function(){this.fullscreenElement.classList.add("FullscreenToggle--isFullscreen"),document.body.classList.add("Body--noScroll");var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this.enterFullscreenCallback()}},{key:"exitFullscreen",value:function(){this.fullscreenElement.classList.remove("FullscreenToggle--isFullscreen"),document.body.classList.remove("Body--noScroll"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),this.exitFullscreenCallback()}}]),t}(Toggle),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Upload=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerEvents",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.querySelectorAll(e.selectors.uploadElement)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=s.querySelector(e.selectors.dropzoneElement);l.addEventListener("dragover",e.handleDragOver),l.addEventListener("dragleave",e.handleDragLeave),l.addEventListener("drop",e.handleDrop),s.querySelector("input[type=file]").addEventListener("change",e.handleChange)}}catch(c){r=!0,i=c}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}},{key:"handleDragOver",value:function(t){return t.preventDefault(),t.currentTarget.classList.add(e.states.onDragOver)}},{key:"handleDragLeave",value:function(t){return t.currentTarget.classList.remove(e.states.onDragOver)}},{key:"handleDrop",value:function(t){t.preventDefault(),t.currentTarget.classList.remove(e.states.onDragOver);var n=parentMatchingSelector(t.currentTarget,e.selectors.uploadElement);e.addFiles(n,t.dataTransfer.files)}},{key:"handleChange",value:function(t){e.addFiles(parentMatchingSelector(t.currentTarget,e.selectors.uploadElement),t.currentTarget.files),console.dir(t.currentTarget),
t.currentTarget.value=""}},{key:"addFiles",value:function(t,n){var r=t.querySelector('input[type="file"]'),i=!0,a=!1,o=void 0;try{for(var s,l=function(){var i=s.value,a=/^image\//;console.log(i.type);var o=document.createElement("div");if(o.classList.add("FileUpload-preview"),o.innerHTML='<div class="FileUpload-preview-info"><span>'+i.name+'</span><button type="button" class="FileUpload-preview-remove Button--transparent Icon Icon-times"></button><span class="FileUpload-preview-size">'+fileSize(i.size)+"</span></div>",t.insertBefore(o,t.firstChild),o.querySelector(e.selectors.removeFile).addEventListener("click",function(a){var s,l;s=a.currentTarget,o=parentMatchingSelector(s,e.selectors.previewElement),l=r.filesToUpload.indexOf(i),l>-1&&r.filesToUpload.splice(l,1),e.recalculateDropzoneVisibility(t,n),o.parentNode.removeChild(o)}),null==r.filesToUpload&&(r.filesToUpload=[]),r.filesToUpload.push(i),a.test(i.type)){var l=new FileReader;l.onload=function(e){o.style.backgroundImage="url("+e.target.result+")"},l.readAsDataURL(i)}else{var c=document.createElement("div");c.classList.add("Icon-container");var u=document.createElement("span");u.classList.add("Icon","Icon--gigantic","Icon--light","Icon-file-text"),c.appendChild(u),o.insertBefore(c,o.firstChild)}},c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)l()}catch(u){a=!0,o=u}finally{try{!i&&c["return"]&&c["return"]()}finally{if(a)throw o}}e.recalculateDropzoneVisibility(t),console.log(n)}},{key:"recalculateDropzoneVisibility",value:function(t,n){var r=t.querySelector('input[type="file"]'),i=t.querySelector(e.selectors.dropzoneElement);!r.multiple&&r.filesToUpload.length>0?i.style.display="none":i.style.display="block"}}]),e}();Upload.selectors={uploadElement:".FileUpload",previewElement:".FileUpload-preview",dropzoneElement:".FileUpload-dropzone",removeFile:".FileUpload-preview-remove"},Upload.states={onDragOver:"FileUpload--onDragOver"};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),CodeViewInterface=function(){function e(t){_classCallCheck(this,e),this.editor=t,this.ace=null}return _createClass(e,[{key:"create",value:function(){var e=ace.edit(this.editor.name+"-ace-editor");e.getSession().setMode("ace/mode/"+this.editor.language),e.setTheme(Preferences.get("editor.ace.theme")),e.getSession().setUseWrapMode(Preferences.get("editor.ace.wordWrap")),e.setHighlightActiveLine(Preferences.get("user.editor.ace.highlightActiveLine")),e.setShowPrintMargin(Preferences.get("editor.ace.showPrintMargin")),e.setShowInvisibles(Preferences.get("editor.ace.showInvisibles")),e.setReadOnly(this.editor.readOnly),this.ace=e,this.view=document.getElementById(this.editor.name+"-ace-editor"),this.view.style.fontSize=Preferences.get("editor.ace.fontSize")}},{key:"show",value:function(e){var t=this;this.view.classList.remove(Editor.classes.state.isHidden),e&&(this.view.style.width="100%"),setTimeout(function(){t.resize()},300)}},{key:"hide",value:function(){console.log("CodeViewInterface.hide"),this.view.classList.add(Editor.classes.state.isHidden)}},{key:"valueFromForm",value:function(){this.ace.setValue(this.editor.textarea.value,-1)}},{key:"valueToForm",value:function(){this.editor.textarea.value=this.ace.getValue()}},{key:"resize",value:function(){this.ace.resize()}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),DesignViewInterface=function(){function e(t){_classCallCheck(this,e),this.editor=t,this.ck=null}return _createClass(e,[{key:"create",value:function(){var e=this,t=Preferences.get("editor.ckeditor",{});t.customConfig=t.customConfig||"",t.contentsCss=this.editor.stylesheets,this.ck=CKEDITOR.replace(this.editor.name+"-editor",t),this.ck.on("instanceReady",function(t){e.view=document.getElementById("cke_"+e.editor.name+"-editor")})}},{key:"show",value:function(e){var t=this;this.ck.on("instanceReady",function(n){t.view.style.display="block",e&&(t.view.style.width="100%")})}},{key:"hide",value:function(){this.view.style.display="none"}},{key:"valueFromForm",value:function(){this.ck.setData(this.editor.textarea.value)}},{key:"valueToForm",value:function(){this.editor.textarea.value=this.ck.getData()}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Editor=function(){function e(t,n,r,i){var a=arguments.length<=4||void 0===arguments[4]?[]:arguments[4];_classCallCheck(this,e),this.enterFullscreen=this.enterFullscreen.bind(this),this.exitFullscreen=this.exitFullscreen.bind(this),this.handleSwitchEditor=this.handleSwitchEditor.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.name=t,this.language=n,this.currentMode=r,this.readOnly=i,this.stylesheets=a,this.modes={},this.textarea=document.querySelector('textarea[name="'+this.name+'"]'),this.container=parentMatchingSelector(this.textarea,"."+e.classes.editor.container);var o=this.container.querySelector("."+e.classes.button.fullscreenToggle);o&&(this.fullscreenToggle=new FullscreenToggle(o,this.container,this.enterFullscreen,this.exitFullscreen)),this.show(),this.resizeToContent(),this.registerEvents()}return _createClass(e,null,[{key:"createEditors",value:function(t){for(var n,r=0;r<t.length;r++){n=t[r];var i=document.querySelector('textarea[name="'+n.name+'"]');if(i){console.log("Editor found"),null==n.mode&&(n.mode=user.editor.defaultMode),console.log(n);var a=new e(n.name,n.language,n.mode,n.readOnly,n.stylesheets);e.list.push(a)}else console.log("Editor not found"),console.log(n)}}}]),_createClass(e,[{key:"getMode",value:function(e){return"undefined"==typeof e||null===e?this.currentMode:e}},{key:"registerEvents",value:function(){var t=this,n=!0,r=!1,i=void 0;try{for(var a,o=this.container.querySelectorAll("."+e.classes.button.switchEditor)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.addEventListener("click",this.handleSwitchEditor)}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}var c=parentMatchingSelector(this.container,"form");null!==c&&c.formObject&&c.formObject.contentGenerators.push(function(e){return t.valueToForm()})}},{key:"create",value:function(e){var t=this.getMode(e);switch(t){case"code":this.modes.code=new CodeViewInterface(this);break;case"design":this.modes.design=new DesignViewInterface(this);break;case"preview":this.modes.preview=new PreviewInterface(this);break;case"split":this.modes.split=new SplitViewInterface(this)}this.modes[t].create()}},{key:"show",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],n=this.getMode(e);null==this.modes[n]&&this.create(n),this.modes[n].show(t),this.currentMode=n,this.valueFromForm(n)}},{key:"hide",value:function(e){var t=this.getMode(e);this.modes[t].hide(),this.valueToForm(t)}},{key:"valueFromForm",value:function(e){var t=this.getMode(e);this.modes[t].valueFromForm()}},{key:"valueToForm",value:function(e){var t=this.getMode(e);this.modes[t].valueToForm()}},{key:"resizeToContainer",value:function(){this.modes.code&&this.modes.code.resize()}},{key:"resizeToContent",value:function(){this.container.querySelector("."+e.classes.editor.content).style.height=1.5*this.textarea.rows+"em",this.modes.code&&this.modes.code.resize()}},{key:"enterFullscreen",value:function(){console.log("fullscreen"),this.resizeToContainer()}},{key:"exitFullscreen",value:function(){console.log("exit"),console.trace(),this.resizeToContent()}},{key:"handleSwitchEditor",value:function(e){console.log("Editor.handleSwitchEditor");var t=e.currentTarget.getAttribute("data-editor");return this.hide(),this.show(t)}},{key:"handleFormSubmit",value:function(){return this.valueToForm()}}]),e}();Editor.list=[],Editor.classes={editor:{container:"Editor",header:"Editor-header",content:"Editor-content",footer:"Editor-footer",preview:"Editor-preview"},state:{isHidden:"Editor--hidden",contentIsSplit:"Editor-content--isSplit"},button:{switchEditor:"Editor--switchEditor",fullscreenToggle:"Editor--toggleFullscreen"}};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),PreviewInterface=function(){function e(t){_classCallCheck(this,e),this.editor=t,this.view=null}return _createClass(e,[{key:"create",value:function(){var e=document.createElement("iframe");e.id=this.editor.name+"-preview",e.classList.add(Editor.classes.editor.preview),this.editor.container.querySelector(".Editor-content").appendChild(e),this.view=e}},{key:"show",value:function(e){var t=document.getElementById(this.editor.name+"-preview");t.classList.remove(Editor.classes.state.isHidden),e&&(t.style.width="100%")}},{key:"hide",value:function(){return document.getElementById(this.editor.name+"-preview").classList.add(Editor.classes.state.isHidden)}},{key:"valueFromForm",value:function(){var e=this;Pace.start();window.fetch("content?content="+encodeURIComponent(this.editor.textarea.value),FetchOptions["default"]().method("get")).then(Oxygen.respond.checkStatus).then(Oxygen.respond.text).then(function(t){e.view.srcdoc=t})["catch"](Oxygen.respond.handleAPIError)}},{key:"valueToForm",value:function(){}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),SplitViewInterface=function(){function e(t){_classCallCheck(this,e),this.editor=t,this.view=null}return _createClass(e,[{key:"create",value:function(){}},{key:"show",value:function(){var e=this.editor.container.querySelectorAll("."+Editor.classes.editor.content),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;o.classList.add(Editor.classes.state.contentIsSplit)}}catch(s){n=!0,r=s}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw r}}var l=this.editor;l.show("code",!1),l.show("preview",!1),l.modes.code.view.style.width="50%",l.modes.preview.view.style.width="50%",l.modes.code.ace.addEventListener("change",this.synchronize.bind(this))}},{key:"hide",value:function(){var e=this.editor.container.querySelectorAll("."+Editor.classes.editor.content),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;o.classList.remove(Editor.classes.state.contentIsSplit)}}catch(s){n=!0,r=s}finally{try{!t&&a["return"]&&a["return"]()}finally{if(n)throw r}}this.editor.hide("code"),this.editor.hide("preview")}},{key:"valueFromForm",value:function(){}},{key:"valueToForm",value:function(){}},{key:"synchronize",value:function(){var e=this;this.currentTimer&&clearTimeout(this.currentTimer),this.currentTimer=setTimeout(function(){"split"===e.editor.currentMode&&(e.editor.valueToForm("code"),e.editor.valueFromForm("preview"))},1e3)}}]),e}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ImageEditor=function(){function e(t){var n=this;if(_classCallCheck(this,e),this.container=t,this.jCropApi=null,this.cropDisableCounter=0,this.cropOrigin={x:0,y:0},this.image=this.container.querySelector("."+e.classes.layout.image),this.$image=$(this.image),!this.image)throw new Error("<img> element doesn't exist");this.forms={simple:this.image.parentNode.parentNode.querySelector("."+e.classes.form.simple),advanced:this.image.parentNode.parentNode.querySelector("."+e.classes.form.advanced)},this.fields={crop:{x:this.container.querySelector('[name="crop[x]"]'),y:this.container.querySelector('[name="crop[y]"]'),width:this.container.querySelector('[name="crop[width]"]'),height:this.container.querySelector('[name="crop[height]"]')},resize:{width:this.container.querySelector('[name="resize[width]"]'),height:this.container.querySelector('[name="resize[height]"]'),keepAspectRatio:this.container.querySelector('[name="resize[keepAspectRatio]"][value="true"]')},macro:this.container.querySelector('[name="macro"]'),name:this.container.querySelector('[name="name"]'),slug:this.container.querySelector('[name="slug"]')},this.image.addEventListener("load",function(e){console.log("Image Loaded");var t=e.currentTarget;n.imageAspectRatio=t.naturalWidth/t.naturalHeight,n.fields.resize.width.value=t.naturalWidth,n.fields.resize.height.value=t.naturalHeight,n.enableCropping()}),this.fullscreenToggle=new FullscreenToggle(this.container.querySelector("."+e.classes.button.toggleFullscreen),this.container),this.container.querySelector("."+e.classes.button.apply).addEventListener("click",this.handlePreview.bind(this)),this.container.querySelector("."+e.classes.button.save).addEventListener("click",this.handleSave.bind(this)),this.container.querySelectorAll("."+e.classes.form.crop).forEach(function(e){e.addEventListener("input",n.handleCropInputChange.bind(n))}),this.container.querySelectorAll("."+e.classes.form.resize).forEach(function(e){e.addEventListener("input",n.handleResizeInputChange.bind(n))})}return _createClass(e,[{key:"handlePreview",value:function(){this.applyChanges(this.gatherData())}},{key:"handleSave",value:function(){var e=this.gatherData();e.save=!0,e.name=this.fields.name.value,e.slug=this.fields.slug.value,this.applyChanges(e),this.progressNotification=new Notification({content:"Saving Image",status:"success"}),NotificationCenter.present(this.progressNotification)}},{key:"gatherData",value:function(){var e=TabSwitcher.list[0].current;switch(e){case"simple":return this.getSimpleData();case"advanced":return this.getAdvancedData();default:return{}}}},{key:"getSimpleData",value:function(){return this.removeDefaultFields(getFormData(this.forms.simple))}},{key:"removeDefaultFields",value:function(e){var t=this,n=function(e){return!(e["resize[width]"]&&e["resize[width]"]!==t.image.naturalWidth.toString()||e["resize[height]"]&&e["resize[height]"]!==t.image.naturalHeight.toString())},r={"fit[position]":function(e){return"center"===e},"resize[width]":function(e,t){return n(t)},"resize[height]":function(e,t){return n(t)},"resize[keepAspectRatio]":function(e,t){return n(t)},gamma:function(e){return"1"===e},greyscale:function(e){return"false"===e},invert:function(e){return"false"===e},"rotate[backgroundColor]":function(e){return"#ffffff"===e},"crop[x]":function(e){void 0===t.pendingCropOrigin&&(t.pendingCropOrigin={}),t.pendingCropOrigin.x=parseInt(e)},"crop[y]":function(e){void 0===t.pendingCropOrigin&&(t.pendingCropOrigin={}),t.pendingCropOrigin.y=parseInt(e)}};for(var i in e){var a=e[i];r[i]&&r[i](a,e)?delete e[i]:("0"===a||""===a)&&delete e[i]}return e}},{key:"getAdvancedData",value:function(){return JSON.parse(this.fields.macro.value)}},{key:"applyChanges",value:function(e){var t=this;return this.applyingChanges?void NotificationCenter.present(new Notification({content:"Already Processing",status:"failed"})):(this.progressNotification=new Notification({content:"Processing Image",status:"success"}),NotificationCenter.present(this.progressNotification),this.applyingChanges=!0,console.log("Processing Image Using Commands: ",e),void window.fetch(this.image.getAttribute("data-root")+"?"+serializeToQueryString(e),FetchOptions["default"]().method("GET").wantJson()).then(Oxygen.respond.checkStatus).then(function(e){return e.blob()}).then(function(e){null!=t.jCropApi&&t.jCropApi.destroy(),t.jCropApi=null,t.cropOrigin=t.pendingCropOrigin;var n=URL.createObjectURL(e);t.image.style.removeProperty("width"),t.image.style.removeProperty("height"),t.image.src=n}).then(function(e){NotificationCenter.present(new Notification({content:"Image Processing Successful",status:"success"})),t.applyingChanges=!1},function(e){throw t.applyingChanges=!1,e})["catch"](Oxygen.respond.handleAPIError))}},{key:"enableCropping",value:function(){var e=this;this.$image.Jcrop({trueSize:[this.image.naturalWidth,this.image.naturalHeight],onChange:this.handleCropSelect.bind(this),onSelect:this.handleCropSelect.bind(this),onRelease:this.handleCropRelease.bind(this)},function(){e.jCropApi=this})}},{key:"handleCropSelect",value:function(e){this.cropDisableCounter<=0?(this.fields.crop.x.value=Math.round(e.x+this.cropOrigin.x).toString(),this.fields.crop.y.value=Math.round(e.y+this.cropOrigin.y).toString(),this.fields.crop.width.value=Math.round(e.w).toString(),this.fields.crop.height.value=Math.round(e.h).toString()):this.cropDisableCounter--}},{key:"handleCropInputChange",value:function(e){if(null!==this.jCropApi){var t=parseInt(""===this.fields.crop.x.value?0:this.fields.crop.x.value),n=parseInt(""===this.fields.crop.y.value?0:this.fields.crop.y.value),r=parseInt(""===this.fields.crop.width.value?0:this.fields.crop.width.value),i=parseInt(""===this.fields.crop.height.value?0:this.fields.crop.height.value);return this.cropDisableCounter=2,this.jCropApi.setSelect([t,n,t+r,n+i])}}},{key:"handleCropRelease",value:function(){this.fields.crop.x.value=0,this.fields.crop.y.value=0,this.fields.crop.width.value=0,this.fields.crop.height.value=0}},{key:"handleResizeInputChange",value:function(e){if(this.fields.resize.keepAspectRatio[0].checked){var t=e.target.name,n=e.target.value;return console.log(t,n),"resize[width]"===t?this.fields.resize.height.value=Math.round(n/this.imageAspectRatio):this.fields.resize.width.value=Math.round(n*this.imageAspectRatio.ratio)}}}],[{key:"initialize",value:function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t.querySelectorAll("."+e.classes.layout.container)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;e.list.push(new e(s))}}catch(l){r=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw i}}}}]),e}();ImageEditor.list=[],ImageEditor.classes={layout:{container:"ImageEditor",image:"ImageEditor-image"},button:{toggleFullscreen:"ImageEditor-toggleFullscreen",save:"ImageEditor-save",apply:"ImageEditor-apply"},form:{simple:"ImageEditor-form--simple",advanced:"ImageEditor-form--advanced",crop:"ImageEditor-crop-input",resize:"ImageEditor-resize-input"}},Oxygen||(Oxygen={}),Oxygen.initLogin=function(){var e=document.querySelector(".Login-form");e.classList.add("Login--noTransition"),e.classList.add("Login--slideDown"),e.offsetHeight,e.classList.remove("Login--noTransition"),setTimeout(function(){document.body.classList.remove("Login--isHidden")},500),document.querySelector(".Login-scrollDown").addEventListener("click",function(){document.querySelector(".Login-message").classList.add("Login--slideUp"),e.classList.remove("Login--slideDown"),document.querySelector(".Login-background--blur").classList.add("Login--isHidden")});var t=e.querySelector("form");t.addEventListener("submit",function(){e.classList.add("Login--slideUp")}),t.modifyPromise=function(t){return t.then(function(t){return"success"!==t.status&&e.classList.remove("Login--slideUp"),t},function(t){throw alert("awesome"),e.classList.remove("Login--slideUp"),t})}},window.Oxygen||(window.Oxygen={}),Oxygen.reset=function(){return window.editors=[],Oxygen.load=[],Oxygen.setBodyScrollable(!0),Dropdown.handleGlobalClick({target:document.body})},Oxygen.setBodyScrollable=function(e){e?document.body.classList.remove("Body--noScroll"):document.body.classList.add("Body--noScroll")},Oxygen.init=function(e){NotificationCenter.initializeExistingMessages(),Dialog.registerEvents(e),ImageEditor.initialize(e),document.querySelector(".Login-form")&&Oxygen.initLogin(),Dropdown.registerEvents(e),EditableList.registerEvents(e),Form.findAll(e),Upload.registerEvents(e),TabSwitcher.findAll(e),Slider.findAll(e),"undefined"!=typeof editors&&null!==editors&&Editor.createEditors(editors);for(var t,n=Oxygen.load||[],r=0;r<n.length;r++)(t=n[r])()},document.addEventListener("DOMContentLoaded",function(){MainNav.headroom(),"undefined"!=typeof user&&null!==user&&Preferences.setPreferences(user),Oxygen.init(document),Preferences.get("pageLoad.smoothState.enabled",!0)===!0&&(window.smoothState=new SmoothState,SmoothState.setTheme(Preferences.get("pageLoad.smoothState.theme","slide")));var e=Preferences.get("pageLoad.progress.theme",["minimal","spinner"]);console.log("Applying progress themes:",e);for(var t,n=0;n<e.length;n++)t=e[n],document.body.classList.add("Page-progress--"+t);Form.registerKeydownHandler(),Dropdown.registerGlobalEvent()});
//# sourceMappingURL=app.min.js.map
